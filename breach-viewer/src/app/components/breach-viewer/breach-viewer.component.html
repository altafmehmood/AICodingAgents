<div class="breach-viewer-container">
  <mat-card class="filter-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>security</mat-icon>
        Breach Viewer
      </mat-card-title>
      <mat-card-subtitle>
        Filter and view data breaches by date range
      </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="breachForm" class="filter-form">
        <div class="date-inputs">
          <mat-form-field appearance="outline">
            <mat-label>From Date</mat-label>
            <input matInput [matDatepicker]="fromPicker" formControlName="fromDate" placeholder="Choose start date">
            <mat-datepicker-toggle matSuffix [for]="fromPicker"></mat-datepicker-toggle>
            <mat-datepicker #fromPicker></mat-datepicker>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>To Date</mat-label>
            <input matInput [matDatepicker]="toPicker" formControlName="toDate" placeholder="Choose end date">
            <mat-datepicker-toggle matSuffix [for]="toPicker"></mat-datepicker-toggle>
            <mat-datepicker #toPicker></mat-datepicker>
          </mat-form-field>
        </div>

        <div class="action-buttons">
          <button 
            mat-raised-button 
            color="primary" 
            (click)="loadBreaches()" 
            [disabled]="loading"
            class="action-button">
            <mat-icon>search</mat-icon>
            Load Breaches
          </button>

          <button 
            mat-raised-button 
            color="accent" 
            (click)="downloadPdf()" 
            [disabled]="loading"
            class="action-button">
            <mat-icon>download</mat-icon>
            Download PDF
          </button>

          <button 
            mat-stroked-button 
            (click)="clearFilters()" 
            [disabled]="loading"
            class="action-button">
            <mat-icon>clear</mat-icon>
            Clear Filters
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- Loading Spinner -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Loading breaches...</p>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="error-message">
    <mat-card class="error-card">
      <mat-card-content>
        <mat-icon color="warn">error</mat-icon>
        {{ errorMessage }}
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Results Section -->
  <div *ngIf="!loading && !errorMessage" class="results-section">
    <mat-card class="results-card">
      <mat-card-header>
        <mat-card-title>
          <mat-icon>list</mat-icon>
          Breaches ({{ breaches.length }})
        </mat-card-title>
      </mat-card-header>

      <mat-card-content>
        <div *ngIf="breaches.length === 0" class="no-results">
          <mat-icon>info</mat-icon>
          <p>No breaches found for the selected date range.</p>
        </div>

        <div *ngIf="breaches.length > 0" class="table-container">
          <table mat-table [dataSource]="breaches" class="breach-table">
            <!-- Title Column -->
            <ng-container matColumnDef="title">
              <th mat-header-cell *matHeaderCellDef>Title</th>
              <td mat-cell *matCellDef="let breach">{{ breach.title }}</td>
            </ng-container>

            <!-- Name Column -->
            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef>Name</th>
              <td mat-cell *matCellDef="let breach">{{ breach.name }}</td>
            </ng-container>

            <!-- Domain Column -->
            <ng-container matColumnDef="domain">
              <th mat-header-cell *matHeaderCellDef>Domain</th>
              <td mat-cell *matCellDef="let breach">{{ breach.domain }}</td>
            </ng-container>

            <!-- Breach Date Column -->
            <ng-container matColumnDef="breachDate">
              <th mat-header-cell *matHeaderCellDef>Breach Date</th>
              <td mat-cell *matCellDef="let breach">{{ formatDate(breach.breachDate) }}</td>
            </ng-container>

            <!-- Pwn Count Column -->
            <ng-container matColumnDef="pwnCount">
              <th mat-header-cell *matHeaderCellDef>Affected Users</th>
              <td mat-cell *matCellDef="let breach">{{ formatNumber(breach.pwnCount) }}</td>
            </ng-container>

            <!-- Description Column -->
            <ng-container matColumnDef="description">
              <th mat-header-cell *matHeaderCellDef>Description</th>
              <td mat-cell *matCellDef="let breach">
                <div class="description-cell">
                  {{ breach.description }}
                </div>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div> 